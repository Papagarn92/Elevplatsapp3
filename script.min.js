const STORAGE_KEY_PREFIX="elevPlatser_";const STUDENT_LIST_IT24A=["Ahmed","Elliott","Yunes","Emil","Charlie","Hadi","Mahmad","Oliver","Mihajlo","Elias","Mohammed","Alexander","Liam","Safa","Nemat","Hugo","Konrad","Michael","Ksawery","Rana","Ludvig"];const STUDENT_LIST_EE25A=["Omar","Ahmed","Fardeen","Hakim","Yousef","Anton","Mihnea","Max-Kellian","Erik","Wiggo","Reda","Max H","Vincent K","Benjamin K","Marin L","Liam","Saade","Matin N","Rumle","Benjamin P","Vincent R G","Ramman","Ayush","Marcel"];const STUDENT_LIST_EE25B=["Kareem","Yousif","Mohamad","Muhammad","Subhan","Farhan","Elliott","Sebastian","Ari","Denislav","Zoya","Seyhmuz","Moschos","Simon","Lionel","M√•ns","Leon","David","Adin","Filip","Metin","Olle","Engjull","Dominic","Emil"];const STUDENT_LIST_TE24=["Hamza","Ludvig","Julian","Kamil","Taha","Melvin","Emma","Sebastian","Almin","Mani","Knut","Jibril","Mojtaba","Otto","Kevin","Jonathan","Odai","Lavin","Stefan"];const STUDENT_LIST_IT23A=["Annas","Dominic And","Dominic Art","Sebastian","Endrit","Liam B","Filip","Yosef","Leonardo","Malcolm","Elijah","Tamim","Eliot","Edwin","Jacob","Liam M","Milo","Benjamin","Mohamed","Armando","Sixten"];const STUDENT_LIST_IT23B=["Adam A","Abdlrahman","Milton","Mark","Andr√©","Nicholas","Anton","Mahan","Lana","Leo","Estelle","Hampus","Isak","Adam N","Ibrahim","Nader","Gabriel","Mohammad","Hugo","Danoa","Emil","Oscar","Fardowso","Vincent"];const STUDENT_LIST_IT24B=["Emilio","Vincent","Can","Emrah","Erand","Enis","William","Milton","Tor","Oskar","Oscar","Devlin","Philip","Isaac","Danyal","Mohsen","Christian","David","Nathaniel","Andi","Muhammed"];const STUDENT_LIST_TE23=["Salman","Ali","Muaaz","Felix","Kamel","Benjamin","Aarez","Mohsin","K√≠an","Ludwig","Husnain","Josef","William","Enes","Batoul","Mustafa","Kevin","Victoria","Artur","Zakaria","Danylo","Abderrahmane","Zahid","Rizky","Sanad","Tindra","Troels","Jan"];const STUDENT_LIST_TE25=["Jacob","Aous","Hassan","Elliot","Lina","Sumalia","Liam","Tariq","Valeriia","Washington","Holger","Yousef","Lukas","Kilian","Linus","Alfred","Mohammed","Mhamd","Mohammad","Edin","Mutlu","Ackilles","Zain","Mikkel","Muneer","Timaf","Leopold"];const CLASS_LISTS={IT24A:STUDENT_LIST_IT24A,EE25A:STUDENT_LIST_EE25A,EE25B:STUDENT_LIST_EE25B,TE24:STUDENT_LIST_TE24,IT23A:STUDENT_LIST_IT23A,IT23B:STUDENT_LIST_IT23B,IT24B:STUDENT_LIST_IT24B,TE23:STUDENT_LIST_TE23,TE25:STUDENT_LIST_TE25};function getSal302Seats(){const currentStudentList=CLASS_LISTS[currentClass]||[];return currentStudentList.length===25?25:24}const CLASSROOM_CONFIG={"Sal 302":{max_seats:25,columns_per_row:8,gang_column_width:"100px",allows_names:true,whiteboard_position:{row:1,col_start:4,span:6},dynamic_seats:true},"NO Salen":{max_seats:25,grid_template_columns:"40px repeat(2, 1fr) 80px repeat(4, 1fr)",allows_names:true,layout_map:[{id:1,row:2,col:2},{id:2,row:2,col:3},{id:3,row:2,col:5},{id:4,row:2,col:6},{id:5,row:2,col:7},{id:6,row:2,col:8},{id:7,row:3,col:2},{id:8,row:3,col:3},{id:9,row:3,col:5},{id:10,row:3,col:6},{id:11,row:3,col:7},{id:12,row:3,col:8},{id:13,row:4,col:2},{id:14,row:4,col:3},{id:15,row:4,col:5},{id:16,row:4,col:6},{id:17,row:4,col:7},{id:18,row:4,col:8},{id:19,row:5,col:2},{id:20,row:5,col:3},{id:21,row:5,col:5},{id:22,row:5,col:6},{id:23,row:5,col:7},{id:24,row:5,col:8},{id:25,row:6,col:5}],whiteboard_position:{row:1,col_start:2,span:7}},"Sal 305":{max_seats:30,allows_names:true,grid_template_columns:"repeat(2, 1fr) 50px repeat(2, 1fr) 50px repeat(2, 1fr)",whiteboard_position:{row:1,col_start:1,span:8},pillar_position:{row:3,col_start:7,span:1},layout_map:[{id:1,row:2,col:1},{id:2,row:2,col:2},{id:3,row:2,col:4},{id:4,row:2,col:5},{id:5,row:2,col:7},{id:6,row:2,col:8},{id:7,row:3,col:1},{id:8,row:3,col:2},{id:9,row:3,col:4},{id:10,row:3,col:5},{id:11,row:4,col:1},{id:12,row:4,col:2},{id:13,row:4,col:4},{id:14,row:4,col:5},{id:15,row:4,col:7},{id:16,row:4,col:8},{id:17,row:5,col:1},{id:18,row:5,col:2},{id:19,row:5,col:4},{id:20,row:5,col:5},{id:21,row:5,col:7},{id:22,row:5,col:8},{id:23,row:6,col:1},{id:24,row:6,col:2},{id:25,row:6,col:4},{id:26,row:6,col:5},{id:27,row:7,col:1},{id:28,row:7,col:2},{id:29,row:7,col:4},{id:30,row:7,col:5}]},"Sal 315":{max_seats:30,allows_names:true,grid_template_columns:"repeat(2, 1fr) 60px repeat(4, 1fr)",whiteboard_position:{row:1,col_start:1,span:7},layout_map:[{id:1,row:2,col:6},{id:2,row:2,col:7},{id:3,row:3,col:4},{id:4,row:3,col:5},{id:5,row:3,col:6},{id:6,row:3,col:7},{id:7,row:4,col:1},{id:8,row:4,col:2},{id:9,row:4,col:4},{id:10,row:4,col:5},{id:11,row:4,col:6},{id:12,row:4,col:7},{id:13,row:5,col:1},{id:14,row:5,col:2},{id:15,row:5,col:4},{id:16,row:5,col:5},{id:17,row:5,col:6},{id:18,row:5,col:7},{id:19,row:6,col:1},{id:20,row:6,col:2},{id:21,row:6,col:4},{id:22,row:6,col:5},{id:23,row:6,col:6},{id:24,row:6,col:7},{id:25,row:7,col:1},{id:26,row:7,col:2},{id:27,row:7,col:4},{id:28,row:7,col:5},{id:29,row:7,col:6},{id:30,row:7,col:7}]}};let currentClassroom=Object.keys(CLASSROOM_CONFIG)[0];let currentClass=Object.keys(CLASS_LISTS)[0];let assignments={};let studentAttributes={};let sensitiveInfoVisible=true;let isLocked=false;let lockCode=null;let failedUnlockAttempts=0;let lockoutUntil=null;let lockoutLevel=0;const MAX_UNLOCK_ATTEMPTS=3;const LOCKOUT_DURATIONS=[0,5*60*1e3,10*60*1e3,30*60*1e3];const classroomSelect=document.getElementById("classroomSelect");const classSelect=document.getElementById("classSelect");const drawButton=document.getElementById("drawButton");const resetButton=document.getElementById("resetButton");const classroomLayout=document.getElementById("classroom-layout");const nameContainer=document.getElementById("name-container");const sortSelect=document.getElementById("sortSelect");const editStudentsButton=document.getElementById("editStudentsButton");const editStudentsModal=document.getElementById("editStudentsModal");const saveStudentsButton=document.getElementById("saveStudentsButton");const closeEditButton=document.getElementById("closeEditButton");const studentsList=document.getElementById("studentsList");const toggleInfoButton=document.getElementById("toggleInfoButton");const fullscreenButton=document.getElementById("fullscreenButton");const exportButton=document.getElementById("exportButton");const importButton=document.getElementById("importButton");const importFileInput=document.getElementById("importFileInput");const lockButton=document.getElementById("lockButton");const lockModal=document.getElementById("lockModal");const unlockModal=document.getElementById("unlockModal");const lockCodeInput=document.getElementById("lockCodeInput");const unlockCodeInput=document.getElementById("unlockCodeInput");const lockConfirmButton=document.getElementById("lockConfirmButton");const lockCancelButton=document.getElementById("lockCancelButton");const unlockConfirmButton=document.getElementById("unlockConfirmButton");const unlockCancelButton=document.getElementById("unlockCancelButton");function getStorageKey(){return`${STORAGE_KEY_PREFIX}${currentClassroom.replace(/\s+/g,"_")}_${currentClass.replace(/\s+/g,"_")}`}function saveData(data){try{localStorage.setItem(getStorageKey(),JSON.stringify(data))}catch(e){console.error("Kunde inte spara",e)}}function loadData(){try{const stored=localStorage.getItem(getStorageKey());return stored?JSON.parse(stored):{assignments:{},studentAttributes:{}}}catch(e){return{assignments:{},studentAttributes:{}}}}function loadStudentAttributes(){try{const key=`studentAttributes_${currentClass.replace(/\s+/g,"_")}`;const stored=localStorage.getItem(key);return stored?JSON.parse(stored):{}}catch(e){return{}}}function saveStudentAttributes(){try{const key=`studentAttributes_${currentClass.replace(/\s+/g,"_")}`;localStorage.setItem(key,JSON.stringify(studentAttributes))}catch(e){console.error("Kunde inte spara elevattribut",e)}}function populateClassroomSelect(){classroomSelect.innerHTML="";for(const name in CLASSROOM_CONFIG){const option=document.createElement("option");option.value=name;option.textContent=name;classroomSelect.appendChild(option)}}function populateClassSelect(){classSelect.innerHTML="";const config=CLASSROOM_CONFIG[currentClassroom];const maxSeats=config?config.max_seats:25;const sortedClassNames=Object.keys(CLASS_LISTS).sort();sortedClassNames.forEach(name=>{const studentCount=CLASS_LISTS[name].length;if(studentCount<=maxSeats){const option=document.createElement("option");option.value=name;option.textContent=name;classSelect.appendChild(option)}});const availableClasses=Array.from(classSelect.options).map(opt=>opt.value);if(availableClasses.includes(currentClass)){classSelect.value=currentClass}else if(availableClasses.length>0){currentClass=availableClasses[0];classSelect.value=currentClass}else{currentClass="";classSelect.innerHTML='<option value="">Inga klasser passar</option>'}}function renderDesks(){classroomLayout.innerHTML="";const config=CLASSROOM_CONFIG[currentClassroom];let max=config.max_seats;if(config.dynamic_seats&&currentClassroom==="Sal 302"){max=getSal302Seats()}const currentStudentList=CLASS_LISTS[currentClass]||[];max=Math.max(max,currentStudentList.length);const whiteboard=document.createElement("div");whiteboard.id="whiteboard";whiteboard.textContent="WHITEBOARD";if(config.whiteboard_position){const pos=config.whiteboard_position;whiteboard.style.gridRowStart=pos.row;whiteboard.style.gridColumnStart=pos.col_start;whiteboard.style.gridColumnEnd="span "+pos.span}else{whiteboard.style.gridRowStart=1;whiteboard.style.gridColumnStart=1;whiteboard.style.gridColumnEnd="span "+(config.columns_per_row||4)/2}classroomLayout.appendChild(whiteboard);if(config.pillar_position){const pillar=document.createElement("div");pillar.className="pillar";pillar.textContent="PELARE";const pos=config.pillar_position;pillar.style.gridRowStart=pos.row;pillar.style.gridColumnStart=pos.col_start;pillar.style.gridColumnEnd="span "+pos.span;classroomLayout.appendChild(pillar)}const renderDesk=deskInfo=>{const desk=document.createElement("div");desk.className="desk";desk.id=`desk-${deskInfo.id}`;const assignment=assignments[deskInfo.id];if(typeof assignment==="string"){const nameDiv=document.createElement("div");nameDiv.textContent=assignment;desk.appendChild(nameDiv);const attrs=studentAttributes[assignment];if(attrs){const attrDiv=document.createElement("div");attrDiv.className="desk-attributes";if(attrs.performance){const badge=document.createElement("span");badge.className=`attribute-badge performance-${attrs.performance}`;const perfText=attrs.performance==="high"?"H":attrs.performance==="medium"?"M":"L";badge.textContent=`üìä${perfText}`;badge.title=`Prestation: ${attrs.performance==="high"?"H√∂g":attrs.performance==="medium"?"Medel":"L√•g"}`;attrDiv.appendChild(badge)}if(attrs.behavior){const badge=document.createElement("span");badge.className=`attribute-badge behavior-${attrs.behavior}`;const behaviorIcon=attrs.behavior==="calm"?"üòå":attrs.behavior==="normal"?"üòê":"üò§";badge.textContent=behaviorIcon;badge.title=`Beteende: ${attrs.behavior==="calm"?"Lugn":attrs.behavior==="normal"?"Normal":"Rastl√∂s"}`;attrDiv.appendChild(badge)}if(attrs.notes){const badge=document.createElement("span");badge.className="attribute-badge";badge.textContent="üìù";badge.title=attrs.notes;attrDiv.appendChild(badge)}desk.appendChild(attrDiv)}desk.classList.add("drawn")}else{desk.textContent=`Plats ${deskInfo.id}`}if(deskInfo.row)desk.style.gridRow=deskInfo.row;if(deskInfo.col)desk.style.gridColumn=`${deskInfo.col} / span ${deskInfo.span||1}`;if(deskInfo.gridColumnStart)desk.style.gridColumnStart=deskInfo.gridColumnStart;if(deskInfo.gridRowStart)desk.style.gridRowStart=deskInfo.gridRowStart;classroomLayout.appendChild(desk)};if(config.layout_map){config.layout_map.forEach(renderDesk)}else{let rowCounter=config.whiteboard_position&&config.whiteboard_position.row===1?2:1;let columnCounter=1;for(let i=0;i<max;i++){let deskNumber=i+1;const seats_per_side=config.columns_per_row/2;let gridColumnStart=columnCounter<=seats_per_side?columnCounter:columnCounter+1;renderDesk({id:deskNumber,gridRowStart:rowCounter,gridColumnStart:gridColumnStart});columnCounter++;if(columnCounter>config.columns_per_row){columnCounter=1;rowCounter++}}}}function updateUI(){const config=CLASSROOM_CONFIG[currentClassroom];const assignedCount=Object.keys(assignments).length;const currentStudentList=CLASS_LISTS[currentClass]||[];let maxSeats=config.max_seats;if(config.dynamic_seats&&currentClassroom==="Sal 302"){maxSeats=getSal302Seats()}drawButton.textContent="Placera Alla Elever";drawButton.disabled=assignedCount>=currentStudentList.length||assignedCount>=maxSeats;if(drawButton.disabled){drawButton.textContent="Alla Placerade (√Öterst√§ll)"}if(isLocked){lockButton.textContent="üîì";lockButton.title="L√•s upp placeringar";drawButton.disabled=true;resetButton.disabled=true;editStudentsButton.disabled=true;classroomSelect.disabled=true;classSelect.disabled=true;sortSelect.disabled=true;exportButton.disabled=true;importButton.disabled=true;toggleInfoButton.disabled=true;if(sensitiveInfoVisible){toggleSensitiveInfo()}}else{lockButton.textContent="üîí";lockButton.title="L√•s placeringar";drawButton.disabled=assignedCount>=currentStudentList.length||assignedCount>=maxSeats;resetButton.disabled=false;editStudentsButton.disabled=false;classroomSelect.disabled=false;classSelect.disabled=false;sortSelect.disabled=false;exportButton.disabled=false;importButton.disabled=false;toggleInfoButton.disabled=false}}function initializeSession(){const config=CLASSROOM_CONFIG[currentClassroom];const savedData=loadData();assignments=savedData.assignments||{};studentAttributes=loadStudentAttributes();if(config.allows_names){populateClassSelect()}renderDesks();updateUI()}function handleClassroomChange(){const selectedSal=classroomSelect.value;const config=CLASSROOM_CONFIG[selectedSal];if(!config)return;currentClassroom=selectedSal;document.body.className=`sal-${selectedSal.replace(/\s+/g,"-")}`;nameContainer.style.display=config.allows_names?"block":"none";if(config.grid_template_columns){classroomLayout.style.gridTemplateColumns=config.grid_template_columns}else{const seats_per_side=config.columns_per_row/2;classroomLayout.style.gridTemplateColumns=`repeat(${seats_per_side}, 1fr) ${config.gang_column_width} repeat(${seats_per_side}, 1fr)`}if(config.grid_template_rows){classroomLayout.style.gridTemplateRows=config.grid_template_rows}else{classroomLayout.style.gridTemplateRows=""}loadLockStatus();initializeSession()}function handleClassChange(){currentClass=classSelect.value;studentAttributes=loadStudentAttributes();initializeSession()}function getNeighbors(seatId,config,maxSeats){const neighbors=[];if(config.layout_map){const seat=config.layout_map.find(s=>s.id===seatId);if(!seat)return neighbors;config.layout_map.forEach(otherSeat=>{if(otherSeat.id===seatId)return;const sameRow=otherSeat.row===seat.row;const adjacentCol=Math.abs(otherSeat.col-seat.col)===1;const sameCol=otherSeat.col===seat.col;const adjacentRow=Math.abs(otherSeat.row-seat.row)===1;if(sameRow&&adjacentCol||sameCol&&adjacentRow){neighbors.push(otherSeat.id)}})}else{const cols=config.columns_per_row;const col=(seatId-1)%cols;if(col>0&&col!==cols/2){neighbors.push(seatId-1)}if(col<cols-1&&col!==cols/2-1){neighbors.push(seatId+1)}if(seatId-cols>0){neighbors.push(seatId-cols)}if(seatId+cols<=maxSeats){neighbors.push(seatId+cols)}}return neighbors}function sortStudents(students){const sortMethod=sortSelect.value;switch(sortMethod){case"alphabetical":return[...students].sort((a,b)=>a.localeCompare(b));case"performance":return[...students].sort((a,b)=>{const perfOrder={high:0,medium:1,low:2,"":3};const perfA=studentAttributes[a]?.performance||"";const perfB=studentAttributes[b]?.performance||"";return perfOrder[perfA]-perfOrder[perfB]});case"behavior":return[...students].sort((a,b)=>{const behaviorOrder={calm:0,normal:1,disruptive:2,"":3};const behaviorA=studentAttributes[a]?.behavior||"";const behaviorB=studentAttributes[b]?.behavior||"";return behaviorOrder[behaviorA]-behaviorOrder[behaviorB]});case"attendance":return[...students].sort((a,b)=>{const attendanceOrder={high:0,medium:1,low:2,"":3};const attendanceA=studentAttributes[a]?.attendance||"";const attendanceB=studentAttributes[b]?.attendance||"";return attendanceOrder[attendanceA]-attendanceOrder[attendanceB]});case"random":default:return[...students].sort(()=>.5-Math.random())}}function smartPlacement(students,allSeats,config,maxSeats){const disruptive=students.filter(s=>studentAttributes[s]?.behavior==="disruptive");const calm=students.filter(s=>studentAttributes[s]?.behavior==="calm");const highPerformers=students.filter(s=>studentAttributes[s]?.performance==="high");const shuffledSeats=[...allSeats].sort(()=>.5-Math.random());const tempAssignments={};const usedSeats=new Set;disruptive.forEach(student=>{let bestSeat=null;let bestScore=-1;for(const seat of shuffledSeats){if(usedSeats.has(seat))continue;const neighbors=getNeighbors(seat,config,maxSeats);let score=0;let hasDisruptiveNeighbor=false;neighbors.forEach(neighborSeat=>{const neighborStudent=tempAssignments[neighborSeat];if(neighborStudent&&studentAttributes[neighborStudent]?.behavior==="disruptive"){hasDisruptiveNeighbor=true}});if(hasDisruptiveNeighbor)continue;score=neighbors.filter(n=>!usedSeats.has(n)).length;if(score>bestScore){bestScore=score;bestSeat=seat}}if(bestSeat){tempAssignments[bestSeat]=student;usedSeats.add(bestSeat)}});const calmAndHigh=[...new Set([...calm,...highPerformers])];const remainingCalm=calmAndHigh.filter(s=>!Object.values(tempAssignments).includes(s));remainingCalm.forEach(student=>{let bestSeat=null;let bestScore=-1;for(const seat of shuffledSeats){if(usedSeats.has(seat))continue;const neighbors=getNeighbors(seat,config,maxSeats);let score=0;neighbors.forEach(neighborSeat=>{const neighborStudent=tempAssignments[neighborSeat];if(neighborStudent&&studentAttributes[neighborStudent]?.behavior==="disruptive"){score+=10}});if(score>bestScore||score===bestScore&&Math.random()>.5){bestScore=score;bestSeat=seat}}if(bestSeat){tempAssignments[bestSeat]=student;usedSeats.add(bestSeat)}});const remaining=students.filter(s=>!Object.values(tempAssignments).includes(s));const remainingSeats=shuffledSeats.filter(s=>!usedSeats.has(s));remaining.forEach((student,index)=>{if(remainingSeats[index]){tempAssignments[remainingSeats[index]]=student}});return tempAssignments}function assignAllAtOnce(){const currentStudentList=CLASS_LISTS[currentClass]||[];if(currentStudentList.length===0){alert("Ingen klasslista hittades.");return}const config=CLASSROOM_CONFIG[currentClassroom];let maxSeats=config.max_seats;if(config.dynamic_seats&&currentClassroom==="Sal 302"){maxSeats=getSal302Seats()}maxSeats=Math.max(maxSeats,currentStudentList.length);if(Object.keys(assignments).length>0&&!confirm("Skriva √∂ver befintlig placering?")){return}assignments={};let allSeats;if(config.layout_map){allSeats=config.layout_map.map(d=>d.id);for(let i=1;i<=maxSeats;i++){if(!allSeats.includes(i))allSeats.push(i)}allSeats.sort((a,b)=>a-b);allSeats=allSeats.slice(0,maxSeats)}else{allSeats=Array.from({length:maxSeats},(_,i)=>i+1)}if(sortSelect.value==="smart"){assignments=smartPlacement(currentStudentList,allSeats,config,maxSeats)}else{const sortedStudents=sortStudents(currentStudentList);const shuffledSeats=[...allSeats].sort(()=>.5-Math.random());sortedStudents.forEach((student,index)=>{const seat=shuffledSeats[index];if(seat!==undefined){assignments[seat]=student}})}saveData({assignments:assignments});renderDesks();updateUI()}function resetSession(){showConfirmModal("√Ñr du s√§ker? Alla placeringar f√∂r denna sal och klass raderas.",()=>{localStorage.removeItem(getStorageKey());assignments={};initializeSession()})}function showConfirmModal(message,onConfirm){const modal=document.getElementById("confirmModal");const confirmMessage=document.getElementById("confirmMessage");const confirmYes=document.getElementById("confirmYes");const confirmNo=document.getElementById("confirmNo");confirmMessage.textContent=message;modal.classList.remove("hidden");const handleConfirm=()=>{modal.classList.add("hidden");confirmYes.removeEventListener("click",handleConfirm);confirmNo.removeEventListener("click",handleCancel);onConfirm()};const handleCancel=()=>{modal.classList.add("hidden");confirmYes.removeEventListener("click",handleConfirm);confirmNo.removeEventListener("click",handleCancel)};confirmYes.addEventListener("click",handleConfirm);confirmNo.addEventListener("click",handleCancel)}function openEditStudentsModal(){const currentStudentList=CLASS_LISTS[currentClass]||[];studentsList.innerHTML="";currentStudentList.forEach(studentName=>{const attrs=studentAttributes[studentName]||{performance:"",behavior:"",notes:""};const row=document.createElement("div");row.className="student-row";row.innerHTML=`
            <div>
                <label>Namn</label>
                <div class="student-name">${studentName}</div>
            </div>
            <div>
                <label>Prestation</label>
                <select data-student="${studentName}" data-attr="performance">
                    <option value="">-</option>
                    <option value="high" ${attrs.performance==="high"?"selected":""}>H√∂g</option>
                    <option value="medium" ${attrs.performance==="medium"?"selected":""}>Medel</option>
                    <option value="low" ${attrs.performance==="low"?"selected":""}>L√•g</option>
                </select>
            </div>
            <div>
                <label>Beteende</label>
                <select data-student="${studentName}" data-attr="behavior">
                    <option value="">-</option>
                    <option value="calm" ${attrs.behavior==="calm"?"selected":""}>Lugn</option>
                    <option value="normal" ${attrs.behavior==="normal"?"selected":""}>Normal</option>
                    <option value="disruptive" ${attrs.behavior==="disruptive"?"selected":""}>Rastl√∂s</option>
                </select>
            </div>
            <div>
                <label>N√§rvaro</label>
                <select data-student="${studentName}" data-attr="attendance">
                    <option value="">-</option>
                    <option value="high" ${attrs.attendance==="high"?"selected":""}>H√∂g</option>
                    <option value="medium" ${attrs.attendance==="medium"?"selected":""}>Mellan</option>
                    <option value="low" ${attrs.attendance==="low"?"selected":""}>L√•g</option>
                </select>
            </div>
            <div>
                <label>Anteckningar</label>
                <input type="text" data-student="${studentName}" data-attr="notes"
                       value="${attrs.notes||""}" placeholder="T.ex. glas√∂gon">
            </div>
        `;studentsList.appendChild(row)});editStudentsModal.classList.remove("hidden")}function saveStudentAttributesFromModal(){const inputs=studentsList.querySelectorAll("select, input");inputs.forEach(input=>{const studentName=input.dataset.student;const attr=input.dataset.attr;const value=input.value;if(!studentAttributes[studentName]){studentAttributes[studentName]={performance:"",behavior:"",attendance:"",notes:""}}studentAttributes[studentName][attr]=value});saveStudentAttributes();editStudentsModal.classList.add("hidden");renderDesks()}function closeEditStudentsModal(){editStudentsModal.classList.add("hidden")}function toggleSensitiveInfo(){sensitiveInfoVisible=!sensitiveInfoVisible;const container=document.querySelector(".container");if(sensitiveInfoVisible){container.classList.remove("hide-sensitive-info");toggleInfoButton.textContent="üëÅÔ∏è";toggleInfoButton.title="D√∂lj k√§nslig information"}else{container.classList.add("hide-sensitive-info");toggleInfoButton.textContent="üôà";toggleInfoButton.title="Visa k√§nslig information"}}function toggleFullscreen(){const container=document.querySelector(".container");if(!document.fullscreenElement){container.requestFullscreen().then(()=>{container.classList.add("fullscreen-mode");fullscreenButton.textContent="‚õ∂"}).catch(err=>{console.error("Kunde inte aktivera fullscreen:",err)})}else{document.exitFullscreen().then(()=>{container.classList.remove("fullscreen-mode");fullscreenButton.textContent="‚õ∂"})}}document.addEventListener("keydown",e=>{if(e.shiftKey&&e.key==="F"){e.preventDefault();toggleFullscreen()}});document.addEventListener("fullscreenchange",()=>{const container=document.querySelector(".container");if(!document.fullscreenElement){container.classList.remove("fullscreen-mode")}});function exportStudentData(){const exportData={className:currentClass,exportDate:(new Date).toISOString(),students:studentAttributes,version:"1.0"};const dataStr=JSON.stringify(exportData,null,2);const dataBlob=new Blob([dataStr],{type:"application/json"});const url=URL.createObjectURL(dataBlob);const link=document.createElement("a");link.href=url;link.download=`elevdata_${currentClass}_${(new Date).toISOString().split("T")[0]}.json`;document.body.appendChild(link);link.click();document.body.removeChild(link);URL.revokeObjectURL(url);alert(`Elevdata f√∂r ${currentClass} har exporterats!`)}function importStudentData(){importFileInput.click()}function handleFileImport(event){const file=event.target.files[0];if(!file)return;const reader=new FileReader;reader.onload=e=>{try{const importData=JSON.parse(e.target.result);if(!importData.students||!importData.className){alert("Ogiltig fil! Filen verkar inte inneh√•lla korrekt elevdata.");return}const confirmMsg=`Vill du importera elevdata f√∂r ${importData.className}?\n\nExporterad: ${new Date(importData.exportDate).toLocaleString("sv-SE")}\n\nDetta kommer att skriva √∂ver befintlig data f√∂r denna klass.`;if(confirm(confirmMsg)){studentAttributes=importData.students;saveStudentAttributes();if(importData.className===currentClass){renderDesks()}alert("Elevdata har importerats!")}}catch(error){alert("Fel vid import: Kunde inte l√§sa filen. Kontrollera att det √§r en giltig JSON-fil.");console.error("Import error:",error)}};reader.readAsText(file);event.target.value=""}function toggleLock(){if(isLocked){unlockModal.classList.remove("hidden")}else{lockModal.classList.remove("hidden")}}function lockPlacements(){const code=lockCodeInput.value.trim();if(code.length!==4||!/^\d{4}$/.test(code)){alert("Ange en giltig 4-siffrig kod!");return}isLocked=true;lockCode=code;lockModal.classList.add("hidden");lockCodeInput.value="";updateUI();const lockData={isLocked:true,lockCode:code,failedAttempts:0};localStorage.setItem(`lock_${getStorageKey()}`,JSON.stringify(lockData));alert("Placeringar l√•sta! Anv√§nd koden f√∂r att l√•sa upp.")}function unlockPlacements(){const code=unlockCodeInput.value.trim();if(code==="NooB"){isLocked=false;lockCode=null;failedUnlockAttempts=0;lockoutUntil=null;lockoutLevel=0;unlockModal.classList.add("hidden");unlockCodeInput.value="";updateUI();localStorage.removeItem(`lock_${getStorageKey()}`);alert("Bypass aktiverad! L√•set √§r nu avst√§ngt.");return}if(lockoutUntil&&Date.now()<lockoutUntil){const remainingTime=Math.ceil((lockoutUntil-Date.now())/1e3/60);alert(`Du √§r utl√•st! F√∂rs√∂k igen om ${remainingTime} minuter.`);unlockCodeInput.value="";return}if(code!==lockCode){failedUnlockAttempts++;if(failedUnlockAttempts>=MAX_UNLOCK_ATTEMPTS){lockoutLevel=Math.min(lockoutLevel+1,LOCKOUT_DURATIONS.length-1);lockoutUntil=Date.now()+LOCKOUT_DURATIONS[lockoutLevel];failedUnlockAttempts=0;const lockData={isLocked:true,lockCode:lockCode,failedAttempts:failedUnlockAttempts,lockoutUntil:lockoutUntil,lockoutLevel:lockoutLevel};localStorage.setItem(`lock_${getStorageKey()}`,JSON.stringify(lockData));const durationMinutes=LOCKOUT_DURATIONS[lockoutLevel]/1e3/60;alert(`F√∂r m√•nga fel f√∂rs√∂k! Du √§r utl√•st i ${durationMinutes} minuter.`);unlockModal.classList.add("hidden");unlockCodeInput.value="";return}alert(`Fel kod! ${MAX_UNLOCK_ATTEMPTS-failedUnlockAttempts} f√∂rs√∂k kvar.`);unlockCodeInput.value="";return}isLocked=false;lockCode=null;failedUnlockAttempts=0;lockoutUntil=null;lockoutLevel=0;unlockModal.classList.add("hidden");unlockCodeInput.value="";updateUI();localStorage.removeItem(`lock_${getStorageKey()}`);alert("Placeringar uppl√•sta!")}function loadLockStatus(){try{const lockData=localStorage.getItem(`lock_${getStorageKey()}`);if(lockData){const parsed=JSON.parse(lockData);isLocked=parsed.isLocked||false;lockCode=parsed.lockCode||null;failedUnlockAttempts=parsed.failedAttempts||0;lockoutUntil=parsed.lockoutUntil||null;lockoutLevel=parsed.lockoutLevel||0;if(lockoutUntil&&Date.now()>lockoutUntil){lockoutUntil=null;lockoutLevel=0;failedUnlockAttempts=0;const updatedLockData={isLocked:isLocked,lockCode:lockCode,failedAttempts:failedUnlockAttempts,lockoutUntil:lockoutUntil,lockoutLevel:lockoutLevel};localStorage.setItem(`lock_${getStorageKey()}`,JSON.stringify(updatedLockData))}}else{isLocked=false;lockCode=null;failedUnlockAttempts=0;lockoutUntil=null;lockoutLevel=0}}catch(e){isLocked=false;lockCode=null;failedUnlockAttempts=0;lockoutUntil=null;lockoutLevel=0}}window.addEventListener("pageshow",event=>{if(event.persisted){console.log("Sidan √•terst√§lld fr√•n bfcache");loadLockStatus();updateUI();if("serviceWorker"in navigator){navigator.serviceWorker.getRegistrations().then(registrations=>{if(registrations.length===0){import("./sw-register.js")}})}const modals=document.querySelectorAll(".modal");modals.forEach(modal=>modal.classList.add("hidden"))}});window.addEventListener("pagehide",event=>{if(event.persisted){console.log("Sidan f√∂rbereds f√∂r bfcache");const modals=document.querySelectorAll(".modal");modals.forEach(modal=>modal.classList.add("hidden"))}});drawButton.addEventListener("click",assignAllAtOnce);resetButton.addEventListener("click",resetSession);classroomSelect.addEventListener("change",handleClassroomChange);classSelect.addEventListener("change",handleClassChange);editStudentsButton.addEventListener("click",openEditStudentsModal);saveStudentsButton.addEventListener("click",saveStudentAttributesFromModal);closeEditButton.addEventListener("click",closeEditStudentsModal);toggleInfoButton.addEventListener("click",toggleSensitiveInfo);fullscreenButton.addEventListener("click",toggleFullscreen);exportButton.addEventListener("click",exportStudentData);importButton.addEventListener("click",importStudentData);importFileInput.addEventListener("change",handleFileImport);lockButton.addEventListener("click",toggleLock);lockConfirmButton.addEventListener("click",lockPlacements);lockCancelButton.addEventListener("click",()=>lockModal.classList.add("hidden"));unlockConfirmButton.addEventListener("click",unlockPlacements);unlockCancelButton.addEventListener("click",()=>unlockModal.classList.add("hidden"));document.addEventListener("DOMContentLoaded",()=>{populateClassroomSelect();populateClassSelect();loadLockStatus();handleClassroomChange();lockCodeInput.addEventListener("keydown",e=>{if(e.key==="Enter"){lockConfirmButton.click()}else if(e.key==="Escape"){lockModal.classList.add("hidden")}});unlockCodeInput.addEventListener("keydown",e=>{if(e.key==="Enter"){unlockConfirmButton.click()}else if(e.key==="Escape"){unlockModal.classList.add("hidden")}});document.addEventListener("keydown",e=>{if(e.key==="Escape"){if(!lockModal.classList.contains("hidden")){lockModal.classList.add("hidden")}else if(!unlockModal.classList.contains("hidden")){unlockModal.classList.add("hidden")}}})});